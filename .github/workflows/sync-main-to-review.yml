name: Create Review PR from main

on:
  push:
    branches:
      - main

jobs:
  create-pr:
    runs-on: ubuntu-latest
    # mainì— ë°±ì¤€í—ˆë¸Œ ì»¤ë°‹ë§Œ ì˜¬ë¼ì˜¨ë‹¤ê³  ê°€ì •
    if: "startsWith(github.event.head_commit.message, 'BaekjoonHub')"

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create Review Branch and PR
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # ì»¤ë°‹ ë©”ì‹œì§€ì—ì„œ ë¬¸ì œ ì´ë¦„ ì¶”ì¶œ (ì˜ˆ: "BaekjoonHub: solved (1000) ...")
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          PROBLEM_ID=$(echo $COMMIT_MSG | grep -oP '(?<=solved \()[0-9]+(?=\))')
          BRANCH_NAME="review/boj-${PROBLEM_ID}-$(date +%s)"
          
          # ìƒˆ ë¸Œëœì¹˜ ìƒì„± ë° í‘¸ì‹œ
          git checkout -b $BRANCH_NAME
          git push origin $BRANCH_NAME
          
          # ìƒˆ ë¸Œëœì¹˜ì—ì„œ mainìœ¼ë¡œ PR ìƒì„±
          gh pr create \
            --base main \
            --head $BRANCH_NAME \
            --title "ğŸ¤– [BOJ] Review for Problem ${PROBLEM_ID}" \
            --body "Code review request for Baekjoon problem ${PROBLEM_ID}. /cc @Seung-zedd"
